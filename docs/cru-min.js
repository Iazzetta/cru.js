const $cru=t=>document.querySelector(t),$crus=t=>document.querySelectorAll(t),$cruConfig={prefix_url:"",headers:{"Content-Type":"application/json"},callbacks:{}},$C=(t=!1)=>{if(t)for(let e of Object.keys(t))$cruConfig[e]=t[e];$cruLoadEvents()},$cruLoadEvents=()=>{$cruLoadRequests(),$cruLoadFormIntercept(),$cruLoadAllContainers()},$cruLoadContainer=async t=>{t.classList.add("loaded");const e=t.closest("[c-container]")||t,r=e.getAttribute("c-container"),c=e.getAttribute("c-target")||!1,a=e.getAttribute("c-type")||"html",n=e.getAttribute("c-callback")||!1,o=await fetch($cruConfig.prefix_url+r,{method:"GET",headers:$cruConfig.headers}),s=await $cruTypeResponse(a,o),d=c?$cru(c):e;(c||"off"!=c)&&(c?d.innerHTML=s:"html"==a&&(d.innerHTML=s)),n&&$cruConfig.callbacks[n](s,d),$cruLoadEvents()},$cruLoadAllContainers=async()=>{$crus("[c-container]:not(.loaded)").forEach(async t=>{t.classList.add("loaded"),$cruLoadContainer(t)}),$crus("[c-reload]:not(.loaded)").forEach(async t=>{t.classList.add("loaded"),t.addEventListener("pointerdown",e=>$cruLoadContainer(t))})},cruRequest=async(t,e)=>{const r=t.getAttribute(`c-${e}`),c=t.getAttribute("c-type")||"html",a=t.getAttribute("c-reload-container")||!1,n=t.getAttribute("c-remove-closest")||!1,o=t.getAttribute("c-redirect")||!1,s=t.getAttribute("c-swap")||!1,d=t.getAttribute("c-callback")||!1,i=t.getAttribute("c-target")||!1,u=await fetch($cruConfig.prefix_url+r,{method:e,headers:$cruConfig.headers}),l=await $cruTypeResponse(c,u),$=!!i&&$cru(i);n&&t.closest(n).remove(),s&&($cru(s).outerHTML=l),a&&$cruLoadContainer(t),$&&($?$.innerHTML=l:"html"==c&&(t.innerHTML=l)),d&&$cruConfig.callbacks[d](l,$),$cruLoadEvents(),o&&(window.location.href=o)},$cruLoadRequests=()=>{$crus("[c-delete]:not(.loaded)").forEach(t=>{t.classList.add("loaded"),t.addEventListener("pointerdown",async e=>{cruRequest(t,"delete")})}),$crus("[c-put]:not(.loaded)").forEach(t=>{t.classList.add("loaded"),t.addEventListener("pointerdown",async e=>{cruRequest(t,"put")})}),$crus("[c-get]:not(.loaded)").forEach(t=>{t.classList.add("loaded"),t.addEventListener("pointerdown",async e=>{cruRequest(t,"get")})}),$crus("[c-post]:not(.loaded)").forEach(t=>{t.classList.add("loaded"),t.addEventListener("pointerdown",async e=>{cruRequest(t,"post")})})},$cruLoadFormIntercept=()=>{$crus(".c-form:not(.loaded)").forEach(t=>{t.classList.add("loaded"),t.addEventListener("submit",async e=>{e.preventDefault();const r=t.getAttribute("action"),c=t.getAttribute("method").toUpperCase()||"POST",a=t.getAttribute("c-type")||"html",n=t.getAttribute("c-append")||!1,o=t.getAttribute("c-prepend")||!1,s=t.getAttribute("c-redirect")||!1,d=t.getAttribute("c-reset")||!1,i=t.getAttribute("c-swap")||!1,u=t.getAttribute("c-target")||!1,l=t.getAttribute("c-reload-container")||!1,$=t.getAttribute("c-callback")||!1,g=$cruIsRead(c),L=Object.fromEntries(new FormData(e.target).entries()),f=cruFormatURL(r,g,L),b=await fetch(f,{method:c,headers:$cruConfig.headers,body:g?null:JSON.stringify(L)}),p=await $cruTypeResponse(a,b);i&&($cru(i).outerHTML=p),n&&$cru(n).insertAdjacentHTML("beforeend",p),o&&$cru(o).insertAdjacentHTML("afterbegin",p),u&&($cru(u).innerHTML=p),d&&t.reset(),l&&$cruLoadContainer(t),$&&$cruConfig.callbacks[$]({status:b.status,data:p},t),$cruLoadEvents(),s&&(window.location.href=s)})})},cruFormatURL=(t,e,r)=>{let c=$cruConfig.prefix_url+t;if(e)try{c=new URL(t)}catch(e){try{c=new URL(window.location.origin+t)}catch(e){throw t}}finally{c.search=new URLSearchParams(r).toString(),c=c.href}return c},$cruCallback=(t,e)=>{$cruConfig.callbacks[t]=e},$cruIsRead=t=>["GET","HEAD"].includes(t),$cruTypeResponse=async(t,e)=>"html"==t?await e.text():await e.json();$C();